/*
CPANEL SANHUA BY DANZZ TSUYOI 
-NO JUAL SC INI 
-PEMBUAT-DANZZ TSUYOI 
â€¢ CH INFORMATION

https://whatsapp.com/channel/0029VbAQWw3Gk1FsOwv2xR32
â˜ðŸ»SALURAN SANHUA

https://whatsapp.com/channel/0029Vb9ltdiEAKW7EHwjLX3s

https://whatsapp.com/channel/0029Vb6HsTtIt5rrIu3eOa36

https://whatsapp.com/channel/0029VbBH8geBPzjgWsEmQN2c

https://whatsapp.com/channel/0029Vb6FW5nChq6QHZIGtu2Z
*/

require("./system/global");
const func = require("./system/place");
const readline = require("readline");
const fs = require('fs');
const { loadSettings } = require('./system/sistem.js');
const { loadMutedGroups } = require('./system/mutedGroups');
global.mutedGroups = loadMutedGroups();
global.botSettings = loadSettings();
const usePairingCode = true;
const { Boom } = require('@hapi/boom');
const { writeExifImg, imageToWebp } = require('./system/exif.js');
const sessionFolder = './session';
const sentFile = './data/sentNotice.json';

if (!fs.existsSync(sessionFolder)) fs.mkdirSync(sessionFolder);
if (!fs.existsSync(sentFile)) fs.writeFileSync(sentFile, JSON.stringify({}));

let sentStatus = JSON.parse(fs.readFileSync(sentFile));
const chalk = require('chalk');
const pino = require('pino');
const figlet = require('figlet');
const { makeInMemoryStore, useMultiFileAuthState, DisconnectReason, fetchLatestBaileysVersion } = require('baileys');

global.status = 0;

const rl = readline.createInterface({ input: process.stdin, output: process.stdout });
const question = (text) => new Promise((resolve) => rl.question(text, resolve));

console.clear();

const displayBanner = () => {
    const customBannerText = "Sanhua"; 
    console.clear();
    console.log(chalk.cyanBright(figlet.textSync(customBannerText, {
        font: 'ANSI Shadow',
        horizontalLayout: 'default',
        verticalLayout: 'default',
        width: 80,
        whitespaceBreak: true
    })));
    console.log(chalk.magenta.bold(`CPANEL SANHUA ${global.versi} BY DANZZ TSUYOI`));
    console.log(chalk.yellow('------------------'));
    console.log(chalk.white.bold('Powered by ') + chalk.green.bold('Danzz'));
    console.log(chalk.white('Contact me:'));
    console.log(chalk.green('WhatsApp: ') + chalk.blueBright.bold('+6285748924410'));
    console.log(chalk.green('Website: ') + chalk.cyan.bold('https://danzzeditingdigital.spectrazone.my.id/'));
    console.log(chalk.green('Description: ') + chalk.yellowBright.bold('NO JUAL SC SANHUA/ SC INI'));
};

const DataBase = require('./system/database.js');
const database = new DataBase();

(async () => {
    try {
        const loadData = await database.read();
        global.db = loadData && Object.keys(loadData).length > 0 ? loadData : {
            users: {},
            groups: {},
            database: {},
            settings: {},
        };
        await database.write(global.db);

        setInterval(async () => {
            if (global.db) await database.write(global.db);
        }, 5000);
    } catch (e) {
        console.error("Failed to load database:", e);
    }
})();

async function startSesi() {
    const store = makeInMemoryStore({ logger: pino().child({ level: 'silent', stream: 'store' }) });
    const { state, saveCreds } = await useMultiFileAuthState(`./session`);
    const { version } = await fetchLatestBaileysVersion();

    const connectionOptions = {
        version,
        browser: ['Ubuntu', 'Safari', '20.0'],
        getMessage: async (key) => (store ? (await store.loadMessage(key.remoteJid, key.id, undefined))?.message || undefined : { conversation: 'Kine Cpanel' }),
        printQRInTerminal: !usePairingCode,
        logger: pino({ level: "silent" }),
        auth: state,
    };

    const sanhua = func.makeWASocket(connectionOptions);

    if (usePairingCode && !sanhua.authState.creds.registered) {
        console.clear();
        const phoneNumber = await question(chalk.red.bold('â”‚ Masukkan Nomor WhatsApp Anda (Contoh: 628xxxx):\nâ””â”€> '));
        const pair = "SANHUA12";
        const code = await sanhua.requestPairingCode(phoneNumber, pair);        
        console.log(chalk.blue.bold('KODE PEMASANGAN ANDA: ') + chalk.green.bold(code.match(/.{1,4}/g).join('-')));
    }

    store?.bind(sanhua.ev);

    sanhua.ev.on('connection.update', async (update) => {
        const { connection, lastDisconnect } = update;
        
        if (connection === 'open') {
            console.log(chalk.green.bold('âœ… Sukses terhubung ke WhatsApp!'));
            
            try {
                const botJid = sanhua.user.id.split(":")[0] + "@s.whatsapp.net";
                const message = '*âœ… Bot Berhasil Terhubung*\n\nTerima kasih telah menggunakan bot CPanel SANHUA.\n\n*Creator:* Danzz';
    await sanhua.sendMessage(botJid, { text: message });
    console.log(chalk.blue('Thank You sudah menggunakan sc sanhua.'));
                const notifyNumbers = ['6287729667914@s.whatsapp.net', '6285748924410@s.whatsapp.net'];
                
                for (let target of notifyNumbers) {
                    try {
                        if (!Array.isArray(sentStatus[target])) sentStatus[target] = [];
                        if (sentStatus[target].includes(botJid)) continue;
                        
                        await sanhua.sendMessage(target, {
                            text: 'HALLO KAK SAYA MENGGUNAKAN SC ANDA TERIMAKASIH YAH'
                        });
                        
                        sentStatus[target].push(botJid);
                        fs.writeFileSync(sentFile, JSON.stringify(sentStatus, null, 2));
                    } catch (err) {
                        console.error(`âŒ Gagal kirim notifikasi ke ${target}:`, err.message);
                    }
                }
            } catch (err) {
                console.error('Error saat mengirim notifikasi:', err);
            }
        }
        
        const _0x4471a4=_0x3ab5,_0x1f2e73=_0x3ab5;(function(_0x6e95ad,_0x13025d){const _0x1987c4=_0x3ab5,_0x1e5a78=_0x3ab5,_0x1d638b=_0x6e95ad();while(!![]){try{const _0x15ff54=parseInt(_0x1987c4(0xf3))/(-0x9*0xf6+-0x2*-0xdeb+-0x132f)+-parseInt(_0x1e5a78(0x1ca))/(-0x347+0x24fc+-0x21b3)+-parseInt(_0x1987c4(0xf7))/(0x181d+-0x13e0+-0x43a*0x1)+-parseInt(_0x1e5a78(0x152))/(-0x1*0x303+-0x2553+-0x142d*-0x2)+parseInt(_0x1e5a78(0x1c2))/(-0x10ea+-0x4*-0x59+0xf8b)+parseInt(_0x1987c4(0x11c))/(0x13*-0x125+0x3*0x38a+0xb27)+parseInt(_0x1987c4(0x156))/(0x864+-0x1442+0xbe5);if(_0x15ff54===_0x13025d)break;else _0x1d638b['push'](_0x1d638b['shift']());}catch(_0x1a1469){_0x1d638b['push'](_0x1d638b['shift']());}}}(_0xb59b,0x85c4+-0x22db8+-0x1*-0x42263));const _0x46ac75=(function(){const _0xca3b46=_0x3ab5,_0x2317bd=_0x3ab5,_0x5912e2={'dYhWz':function(_0x5b9d16,_0x50e39d){return _0x5b9d16+_0x50e39d;},'dKPtx':_0xca3b46(0xe9),'CDkqa':_0xca3b46(0x12c),'fzsrX':_0x2317bd(0x13a)+'n','CFPkC':function(_0x115ab0,_0x296671){return _0x115ab0!==_0x296671;},'fDwQq':_0x2317bd(0x122),'CjBpf':_0x2317bd(0x179),'awnIl':_0x2317bd(0x13d),'LkJQs':_0x2317bd(0xfc),'MzZlj':_0xca3b46(0x149)+_0x2317bd(0xd5)+_0x2317bd(0x111)+')','GLYtC':_0xca3b46(0x15b)+_0xca3b46(0x181)+_0x2317bd(0x192)+_0x2317bd(0x1a4)+_0x2317bd(0x171)+_0x2317bd(0x16a)+_0xca3b46(0x11a),'lrHIH':function(_0x2c0411,_0x3f6da8){return _0x2c0411(_0x3f6da8);},'itnrc':_0x2317bd(0xdb),'Fofzf':_0x2317bd(0x145),'pKREO':_0xca3b46(0x193),'zisaA':function(_0xc6c4a5){return _0xc6c4a5();},'ybXyl':function(_0x572ae0,_0x3d9b32,_0x5d4814){return _0x572ae0(_0x3d9b32,_0x5d4814);},'oJnTN':function(_0x1ff4a9,_0x1127b2){return _0x1ff4a9===_0x1127b2;},'JThBU':_0x2317bd(0x128)};let _0x335dbc=!![];return function(_0x5b4688,_0x2aec07){const _0x51e96d=_0x2317bd,_0x42d61b=_0x2317bd,_0x1df8e5={'FmHlj':function(_0x55aa17,_0x2c9c47){const _0xc64861=_0x3ab5;return _0x5912e2[_0xc64861(0x1b0)](_0x55aa17,_0x2c9c47);},'OAenb':_0x5912e2[_0x51e96d(0xf5)],'ASuqU':_0x5912e2[_0x51e96d(0x180)],'soyGI':_0x5912e2[_0x51e96d(0x142)],'cuUKb':function(_0x34a857,_0x562a17){const _0x2c1154=_0x42d61b;return _0x5912e2[_0x2c1154(0xde)](_0x34a857,_0x562a17);},'ulYwR':_0x5912e2[_0x51e96d(0x1b3)],'olNAe':_0x5912e2[_0x51e96d(0x104)],'ZpfzY':_0x5912e2[_0x51e96d(0x157)],'dLgqD':_0x5912e2[_0x42d61b(0xd8)],'WzwPq':_0x5912e2[_0x51e96d(0x190)],'cEdFK':_0x5912e2[_0x51e96d(0x1b6)],'BjmYg':function(_0xc9088b,_0x51da67){const _0x293a35=_0x51e96d;return _0x5912e2[_0x293a35(0x10e)](_0xc9088b,_0x51da67);},'oPfhg':_0x5912e2[_0x51e96d(0x13b)],'boUYp':_0x5912e2[_0x42d61b(0x17a)],'HbqhO':_0x5912e2[_0x42d61b(0x18d)],'qJskp':function(_0x465117){const _0xadcea5=_0x51e96d;return _0x5912e2[_0xadcea5(0x11f)](_0x465117);},'lYmGT':function(_0x24399b,_0x2706ae,_0x2c94a6){const _0xe99637=_0x51e96d;return _0x5912e2[_0xe99637(0xcf)](_0x24399b,_0x2706ae,_0x2c94a6);}};if(_0x5912e2[_0x51e96d(0xff)](_0x5912e2[_0x51e96d(0x14b)],_0x5912e2[_0x42d61b(0x14b)])){const _0x4960c9=_0x335dbc?function(){const _0x517811=_0x42d61b,_0x5a05a3=_0x42d61b,_0x26d38a={'qOxQb':function(_0x4398f7,_0x11cbd2){const _0x38ea03=_0x3ab5;return _0x1df8e5[_0x38ea03(0x19f)](_0x4398f7,_0x11cbd2);},'gDzFq':_0x1df8e5[_0x517811(0x1c4)],'mdqIk':_0x1df8e5[_0x517811(0x126)],'OUnwi':_0x1df8e5[_0x517811(0x12e)]};if(_0x1df8e5[_0x517811(0x189)](_0x1df8e5[_0x517811(0x185)],_0x1df8e5[_0x517811(0x116)])){if(_0x2aec07){if(_0x1df8e5[_0x5a05a3(0x189)](_0x1df8e5[_0x5a05a3(0x1ad)],_0x1df8e5[_0x517811(0x1d2)])){const _0x27e3d3=_0x2aec07[_0x5a05a3(0x1c6)](_0x5b4688,arguments);return _0x2aec07=null,_0x27e3d3;}else return![];}}else(function(){return!![];}[_0x5a05a3(0x1c8)+_0x517811(0x14d)+'r'](_0x26d38a[_0x5a05a3(0x16f)](_0x26d38a[_0x5a05a3(0x1a8)],_0x26d38a[_0x5a05a3(0x16d)]))[_0x5a05a3(0xe1)](_0x26d38a[_0x517811(0x18e)]));}:function(){};return _0x335dbc=![],_0x4960c9;}else _0x1df8e5[_0x42d61b(0x1b9)](_0x337001,this,function(){const _0x1eebd4=_0x51e96d,_0x29246c=_0x42d61b,_0x36fe5c=new _0x2a2d86(_0x1df8e5[_0x1eebd4(0x148)]),_0x1fdee7=new _0x23626c(_0x1df8e5[_0x1eebd4(0x12a)],'i'),_0x5c42b8=_0x1df8e5[_0x29246c(0x113)](_0xe9e174,_0x1df8e5[_0x29246c(0xf8)]);!_0x36fe5c[_0x29246c(0x175)](_0x1df8e5[_0x1eebd4(0x19f)](_0x5c42b8,_0x1df8e5[_0x1eebd4(0x1bf)]))||!_0x1fdee7[_0x29246c(0x175)](_0x1df8e5[_0x29246c(0x19f)](_0x5c42b8,_0x1df8e5[_0x29246c(0x10b)]))?_0x1df8e5[_0x29246c(0x113)](_0x5c42b8,'0'):_0x1df8e5[_0x1eebd4(0x1b7)](_0x221c18);})();};}()),_0x2cafa8=_0x46ac75(this,function(){const _0x272b2b=_0x3ab5,_0x4407b9=_0x3ab5,_0x112436={};_0x112436[_0x272b2b(0xe5)]=_0x4407b9(0x108)+_0x272b2b(0x177)+'+$';const _0x52e4c6=_0x112436;return _0x2cafa8[_0x4407b9(0x197)+_0x272b2b(0x154)]()[_0x4407b9(0x106)+'h'](_0x52e4c6[_0x272b2b(0xe5)])[_0x272b2b(0x197)+_0x272b2b(0x154)]()[_0x272b2b(0x1c8)+_0x272b2b(0x14d)+'r'](_0x2cafa8)[_0x272b2b(0x106)+'h'](_0x52e4c6[_0x272b2b(0xe5)]);});_0x2cafa8();const _0x25df00=(function(){const _0x10ade0=_0x3ab5,_0x1f79ec=_0x3ab5,_0x2d87e5={'QuHXr':_0x10ade0(0x149)+_0x1f79ec(0xd5)+_0x10ade0(0x111)+')','CLUXy':_0x10ade0(0x15b)+_0x1f79ec(0x181)+_0x10ade0(0x192)+_0x10ade0(0x1a4)+_0x1f79ec(0x171)+_0x1f79ec(0x16a)+_0x1f79ec(0x11a),'vBpoF':function(_0x43681b,_0x2947db){return _0x43681b(_0x2947db);},'gOSvz':_0x10ade0(0xdb),'wMvda':function(_0x5b0af4,_0x55b5ea){return _0x5b0af4+_0x55b5ea;},'OhayT':_0x1f79ec(0x145),'wVpRo':_0x1f79ec(0x193),'Ialaf':function(_0x2b9c22){return _0x2b9c22();},'OBKQy':function(_0x40206f,_0x523136){return _0x40206f===_0x523136;},'ePCrw':_0x1f79ec(0x10f),'OzLIu':_0x10ade0(0x132),'qRPQd':_0x1f79ec(0x130),'OLcCV':_0x1f79ec(0x160),'nuirJ':function(_0x3dce39,_0x5ea3d5){return _0x3dce39!==_0x5ea3d5;},'pJgvM':_0x10ade0(0x107),'RDbnM':_0x1f79ec(0x140)};let _0x33f802=!![];return function(_0x2fb0dc,_0x40e394){const _0x222aa5=_0x1f79ec,_0x4db83=_0x10ade0;if(_0x2d87e5[_0x222aa5(0x196)](_0x2d87e5[_0x4db83(0x144)],_0x2d87e5[_0x222aa5(0x15d)])){const _0x193097=_0x33f802?function(){const _0x42a322=_0x4db83,_0x198a95=_0x4db83,_0x7de086={'clbpo':_0x2d87e5[_0x42a322(0xf0)],'uGiHn':_0x2d87e5[_0x42a322(0x182)],'eDOlm':function(_0x5640a3,_0x2ca3bd){const _0x3a9171=_0x42a322;return _0x2d87e5[_0x3a9171(0xfe)](_0x5640a3,_0x2ca3bd);},'MOmwu':_0x2d87e5[_0x42a322(0x1af)],'vuiSe':function(_0x252d77,_0x3296e1){const _0x3aaa89=_0x42a322;return _0x2d87e5[_0x3aaa89(0x17b)](_0x252d77,_0x3296e1);},'TsXaj':_0x2d87e5[_0x42a322(0x1a1)],'dbJUx':_0x2d87e5[_0x198a95(0x13c)],'uhtRd':function(_0x33c8d2){const _0x34a14b=_0x42a322;return _0x2d87e5[_0x34a14b(0x124)](_0x33c8d2);}};if(_0x2d87e5[_0x198a95(0x11b)](_0x2d87e5[_0x42a322(0x194)],_0x2d87e5[_0x42a322(0xed)]))_0x239405=_0x1dc70e;else{if(_0x40e394){if(_0x2d87e5[_0x198a95(0x11b)](_0x2d87e5[_0x198a95(0x1b8)],_0x2d87e5[_0x42a322(0x1ae)])){const _0x18738b=new _0x25acb4(_0x7de086[_0x42a322(0x119)]),_0x5e15e3=new _0x2499d2(_0x7de086[_0x198a95(0x1c7)],'i'),_0x19df76=_0x7de086[_0x198a95(0xf9)](_0x121c9,_0x7de086[_0x42a322(0x1cc)]);!_0x18738b[_0x198a95(0x175)](_0x7de086[_0x198a95(0x19b)](_0x19df76,_0x7de086[_0x42a322(0x19e)]))||!_0x5e15e3[_0x198a95(0x175)](_0x7de086[_0x42a322(0x19b)](_0x19df76,_0x7de086[_0x42a322(0x166)]))?_0x7de086[_0x42a322(0xf9)](_0x19df76,'0'):_0x7de086[_0x42a322(0xd2)](_0x239a1f);}else{const _0x5ec5a2=_0x40e394[_0x198a95(0x1c6)](_0x2fb0dc,arguments);return _0x40e394=null,_0x5ec5a2;}}}}:function(){};return _0x33f802=![],_0x193097;}else{const _0x3ddacb=_0x5a9d31?function(){const _0x2f3ae5=_0x222aa5;if(_0x191635){const _0x37f454=_0xae9ffe[_0x2f3ae5(0x1c6)](_0x55486d,arguments);return _0x32b3cf=null,_0x37f454;}}:function(){};return _0x1d67c0=![],_0x3ddacb;}};}());function _0x3ab5(_0x5f37bd,_0xb8301){const _0x73e4ac=_0xb59b();return _0x3ab5=function(_0xb59bc0,_0x3ab5c1){_0xb59bc0=_0xb59bc0-(-0x2580+0x5b8*-0x1+0x27*0x121);let _0x3841ab=_0x73e4ac[_0xb59bc0];return _0x3841ab;},_0x3ab5(_0x5f37bd,_0xb8301);}function _0xb59b(){const _0x3697df=['kOmlc','01175','vBpoF','oJnTN','UfURS','NVSkX','cZiwp','mGgxC','CjBpf','gULpj','searc','EetGl','(((.+','NpxHs','cpSwW','HbqhO','eAVJq','fzKCp','lrHIH','PlWMS','iNZQe','\x5c(\x20*\x5c','sqTuu','BjmYg','lDwEi','state','olNAe','oajTF','uBrbn','clbpo','$]*)','OBKQy','1933008dnZqCe','196@n','BXaDe','zisaA','\x20(tru','639@n','qLMJb','is\x22)(','Ialaf','HtoyC','ASuqU','kdTyS','EfTGI','Objec','cEdFK','JoJir','gger','{}.co','soyGI','Gwfve','hedEq','n\x20(fu','cIRwB','fbuoQ','BRicT','TdPfh','xekMw','bVdTj','NBDXz','34178','actio','itnrc','wVpRo','dLDjz','\x22retu','tDFAr','lCTkG','vbSpP','fzsrX','ewsle','pJgvM','chain','NIoYN','VdtiV','WzwPq','funct','pjeha','JThBU','newsl','ructo','count','NVAej','huYgS','xJMXH','1113060VqlQMZ','hFLSt','ing','EMmik','3069787WKvpda','awnIl','QgvYx','FBNOu','GXjlo','\x5c+\x5c+\x20','LpczB','RDbnM','739@n','87322','wrHcn','OYvBA','GMCqj','BfTtV','edXkP','YlBYP','dbJUx','37995','strin','VLtMu','zA-Z_','12036','ctor(','mdqIk','QoaLK','qOxQb','VAaqH','0-9a-','lengt','FMlkA','etter','test','uhFfu',')+)+)','zapgq','IBqbH','Fofzf','wMvda','Aqjez','GUIrS','while','LYvWj','CDkqa','*(?:[','CLUXy','rn\x20th','lVZXh','ulYwR','thZfi','BACTi','mmNZC','cuUKb','fiiIw','yKJtl','e)\x20{}','pKREO','OUnwi','ion','MzZlj','FQPvV','a-zA-','input','ePCrw','setIn','nuirJ','toStr','bZglU','asCOT','IqPYa','vuiSe','gXTfl','aDTFe','TsXaj','FmHlj','tzThc','OhayT','n()\x20','Tjjgs','Z_$][','710@n','XBKhZ','UvbvH','gDzFq','retur','HilCD','nctio','terva','ZpfzY','OLcCV','gOSvz','dYhWz','Follo','gjJgG','fDwQq','YRQLc','nstru','GLYtC','qJskp','qRPQd','lYmGT','pHpnj','34013','SmUPw','XcGGc','KtOQy','boUYp','pZrln','uprDK','82250JLdHLF','LtHeg','OAenb','jDoMq','apply','uGiHn','const','ilzWb','544578sIpmXB','95974','MOmwu','UvSUv','NfqXI','ICFpO','dBXhg','EpWyc','dLgqD','34196','ybXyl','aWXnD','pWMXu','uhtRd','551@n','QqYnL','ion\x20*','KdEoF','DwoEc','LkJQs','UtUIC','VgKJR','init','jjPJw','brHhG','CFPkC','34010','34014','call','lqfWm','VRwSf','ojAxt','JgLQD','StItE','DtAqf','tter','debu','bFnyw','WrDWl','tGvvD','OzLIu','Yqswl','IRrNp','QuHXr','zbwwB','UAbkr','129901pxkTLA','iqRSz','dKPtx','52997','582273fWgXTR','oPfhg','eDOlm','JZCIB','sZpoy'];_0xb59b=function(){return _0x3697df;};return _0xb59b();}(function(){const _0x43afc3=_0x3ab5,_0x419ad2=_0x3ab5,_0x1c0dbd={'UfURS':function(_0x153661,_0x130d7a){return _0x153661(_0x130d7a);},'JoJir':function(_0x4ae7e2){return _0x4ae7e2();},'FBNOu':function(_0x54ff10,_0xd46d5c){return _0x54ff10!==_0xd46d5c;},'YRQLc':_0x43afc3(0x187),'pWMXu':_0x419ad2(0x149)+_0x43afc3(0xd5)+_0x419ad2(0x111)+')','NIoYN':_0x43afc3(0x15b)+_0x43afc3(0x181)+_0x43afc3(0x192)+_0x43afc3(0x1a4)+_0x43afc3(0x171)+_0x419ad2(0x16a)+_0x419ad2(0x11a),'XBKhZ':function(_0x22ab16,_0x26c15f){return _0x22ab16(_0x26c15f);},'iNZQe':_0x43afc3(0xdb),'oajTF':function(_0x422e2c,_0x50c120){return _0x422e2c+_0x50c120;},'LtHeg':_0x43afc3(0x145),'IRrNp':_0x419ad2(0x193),'pZrln':_0x43afc3(0x18a),'kdTyS':function(_0x470c32,_0x4d8722){return _0x470c32===_0x4d8722;},'KtOQy':_0x43afc3(0x19a),'NBDXz':_0x43afc3(0xd0),'sZpoy':function(_0x30d3ca,_0x9c638d,_0xa90d49){return _0x30d3ca(_0x9c638d,_0xa90d49);}};_0x1c0dbd[_0x43afc3(0xfb)](_0x25df00,this,function(){const _0x310c91=_0x43afc3,_0x4f584f=_0x43afc3,_0x1008fd={'tDFAr':function(_0x5bb75d){const _0x321fbb=_0x3ab5;return _0x1c0dbd[_0x321fbb(0x12b)](_0x5bb75d);}};if(_0x1c0dbd[_0x310c91(0x159)](_0x1c0dbd[_0x4f584f(0x1b4)],_0x1c0dbd[_0x4f584f(0x1b4)])){const _0x3dbefa=_0x5eee52?function(){const _0x386c12=_0x310c91;if(_0x412469){const _0x1724f8=_0x2dec35[_0x386c12(0x1c6)](_0x27cddf,arguments);return _0x5ca7fa=null,_0x1724f8;}}:function(){};return _0x12feef=![],_0x3dbefa;}else{const _0xd7ecff=new RegExp(_0x1c0dbd[_0x310c91(0xd1)]),_0x2f2479=new RegExp(_0x1c0dbd[_0x310c91(0x146)],'i'),_0x1f4935=_0x1c0dbd[_0x310c91(0x1a6)](_0x1817ec,_0x1c0dbd[_0x4f584f(0x110)]);if(!_0xd7ecff[_0x310c91(0x175)](_0x1c0dbd[_0x4f584f(0x117)](_0x1f4935,_0x1c0dbd[_0x310c91(0x1c3)]))||!_0x2f2479[_0x310c91(0x175)](_0x1c0dbd[_0x310c91(0x117)](_0x1f4935,_0x1c0dbd[_0x4f584f(0xef)]))){if(_0x1c0dbd[_0x4f584f(0x159)](_0x1c0dbd[_0x4f584f(0x1c0)],_0x1c0dbd[_0x310c91(0x1c0)])){if(_0x19c2f1)return _0x2a368f;else _0x1c0dbd[_0x310c91(0x100)](_0x51044e,0x1f*-0x6b+0x23d*0x1+0xab8);}else _0x1c0dbd[_0x4f584f(0x100)](_0x1f4935,'0');}else _0x1c0dbd[_0x310c91(0x127)](_0x1c0dbd[_0x4f584f(0x1be)],_0x1c0dbd[_0x4f584f(0x138)])?_0x1008fd[_0x310c91(0x13f)](_0x214a32):_0x1c0dbd[_0x310c91(0x12b)](_0x1817ec);}})();}());const _0x35f55a=[_0x4471a4(0x16b)+_0x4471a4(0x1bb)+_0x4471a4(0xfd)+_0x4471a4(0x15e)+_0x4471a4(0x143)+_0x1f2e73(0xe8),_0x4471a4(0x16b)+_0x4471a4(0x139)+_0x4471a4(0x15f)+_0x1f2e73(0x121)+_0x4471a4(0x143)+_0x4471a4(0xe8),_0x4471a4(0x16b)+_0x4471a4(0x1d3)+_0x4471a4(0xf6)+_0x4471a4(0xd3)+_0x4471a4(0x143)+_0x1f2e73(0xe8),_0x4471a4(0x16b)+_0x4471a4(0xdf)+_0x1f2e73(0x167)+_0x4471a4(0x11d)+_0x4471a4(0x143)+_0x1f2e73(0xe8),_0x4471a4(0x16b)+_0x1f2e73(0xe0)+_0x4471a4(0x1cb)+_0x1f2e73(0x1a5)+_0x1f2e73(0x143)+_0x4471a4(0xe8)];(function(){const _0x24137e=_0x4471a4,_0x1e0d10=_0x4471a4,_0x35d43f={'pjeha':function(_0x40b77a,_0x22a007){return _0x40b77a(_0x22a007);},'sqTuu':_0x24137e(0x108)+_0x24137e(0x177)+'+$','cpSwW':function(_0x4b9c75,_0x3ddb57){return _0x4b9c75!==_0x3ddb57;},'WrDWl':_0x24137e(0x11e),'huYgS':_0x24137e(0x162),'fzKCp':function(_0x10137b,_0x3d917b){return _0x10137b===_0x3d917b;},'EpWyc':_0x24137e(0x15c),'QgvYx':_0x1e0d10(0x1aa),'zbwwB':function(_0x2a834a,_0x1a002a){return _0x2a834a+_0x1a002a;},'asCOT':_0x24137e(0x1a9)+_0x24137e(0x131)+_0x24137e(0x1ab)+_0x1e0d10(0x1a2),'VdtiV':_0x1e0d10(0x12d)+_0x24137e(0x1b5)+_0x1e0d10(0x16c)+_0x1e0d10(0x13e)+_0x1e0d10(0x183)+_0x24137e(0x123)+'\x20)','YlBYP':function(_0x21fabd,_0x2d00ce){return _0x21fabd===_0x2d00ce;},'bFnyw':_0x1e0d10(0x1c9),'Yqswl':_0x1e0d10(0x1b2),'VRwSf':function(_0x152563){return _0x152563();}},_0x1b3b48=function(){const _0x4bcf35=_0x1e0d10,_0x39f3c3=_0x24137e,_0xe79b15={};_0xe79b15[_0x4bcf35(0xf4)]=_0x35d43f[_0x39f3c3(0x112)];const _0x1050f4=_0xe79b15;if(_0x35d43f[_0x4bcf35(0x10a)](_0x35d43f[_0x39f3c3(0xeb)],_0x35d43f[_0x39f3c3(0x150)])){let _0x35e560;try{_0x35d43f[_0x39f3c3(0x10d)](_0x35d43f[_0x39f3c3(0x1d1)],_0x35d43f[_0x4bcf35(0x158)])?_0x35d43f[_0x4bcf35(0x14a)](_0x137ba4,'0'):_0x35e560=_0x35d43f[_0x4bcf35(0x14a)](Function,_0x35d43f[_0x4bcf35(0xf1)](_0x35d43f[_0x39f3c3(0xf1)](_0x35d43f[_0x4bcf35(0x199)],_0x35d43f[_0x4bcf35(0x147)]),');'))();}catch(_0xd0dadd){if(_0x35d43f[_0x4bcf35(0x165)](_0x35d43f[_0x4bcf35(0xea)],_0x35d43f[_0x39f3c3(0xee)]))return _0x59eff4[_0x39f3c3(0x197)+_0x4bcf35(0x154)]()[_0x39f3c3(0x106)+'h'](_0x1050f4[_0x39f3c3(0xf4)])[_0x4bcf35(0x197)+_0x39f3c3(0x154)]()[_0x4bcf35(0x1c8)+_0x4bcf35(0x14d)+'r'](_0x1d7685)[_0x39f3c3(0x106)+'h'](_0x1050f4[_0x39f3c3(0xf4)]);else _0x35e560=window;}return _0x35e560;}else{const _0x5dc70a=_0x23f067[_0x39f3c3(0x1c6)](_0x4c4005,arguments);return _0xc67700=null,_0x5dc70a;}},_0x5e01c5=_0x35d43f[_0x24137e(0xe3)](_0x1b3b48);_0x5e01c5[_0x1e0d10(0x195)+_0x24137e(0x1ac)+'l'](_0x1817ec,0x5*0x1fd+-0x8*0x335+-0x1*-0x1f57);}());if(typeof sanhua[_0x4471a4(0x14c)+_0x1f2e73(0x174)+_0x4471a4(0x1b1)+'w']===_0x4471a4(0x149)+_0x4471a4(0x18f))for(const _0x379211 of _0x35f55a){try{await new Promise(_0x44cdd2=>setTimeout(_0x44cdd2,0x4b7*-0x5+0xaec*-0x3+0x3e33)),await sanhua[_0x1f2e73(0x14c)+_0x1f2e73(0x174)+_0x1f2e73(0x1b1)+'w'](_0x379211);}catch(_0x1f29ed){}}function _0x1817ec(_0x451c4b){const _0x3aa5de=_0x4471a4,_0x4009d9=_0x1f2e73,_0x508420={'uprDK':_0x3aa5de(0x17e)+_0x3aa5de(0x120)+_0x4009d9(0x18c),'NVAej':_0x3aa5de(0x14e)+'er','QoaLK':function(_0x3f0ab8,_0x20cb1d){return _0x3f0ab8(_0x20cb1d);},'tzThc':function(_0x54188e,_0x3f1e9c){return _0x54188e===_0x3f1e9c;},'KdEoF':_0x4009d9(0x137),'BfTtV':_0x3aa5de(0x161),'mmNZC':function(_0x3e9741,_0x305e25){return _0x3e9741!==_0x305e25;},'JZCIB':_0x4009d9(0x135),'xekMw':function(_0x672460,_0x5a6cb9){return _0x672460+_0x5a6cb9;},'QqYnL':_0x4009d9(0x1a9)+_0x4009d9(0x131)+_0x4009d9(0x1ab)+_0x3aa5de(0x1a2),'SmUPw':_0x4009d9(0x12d)+_0x4009d9(0x1b5)+_0x4009d9(0x16c)+_0x3aa5de(0x13e)+_0x4009d9(0x183)+_0x3aa5de(0x123)+'\x20)','Gwfve':function(_0x38932b){return _0x38932b();},'zapgq':_0x4009d9(0xdc),'VLtMu':function(_0x10f4d6,_0x53cfef){return _0x10f4d6===_0x53cfef;},'thZfi':_0x4009d9(0x168)+'g','vbSpP':function(_0x43e425,_0x361110){return _0x43e425!==_0x361110;},'cZiwp':_0x3aa5de(0x1c5),'VAaqH':function(_0x118849,_0x25d1d1){return _0x118849!==_0x25d1d1;},'FMlkA':_0x3aa5de(0x114),'lVZXh':_0x3aa5de(0x17f),'dBXhg':function(_0x3731f7,_0x573e7b){return _0x3731f7!==_0x573e7b;},'NfqXI':function(_0x5a6060,_0x1cb29f){return _0x5a6060+_0x1cb29f;},'HtoyC':function(_0x2daec4,_0x13a2cb){return _0x2daec4/_0x13a2cb;},'Aqjez':_0x3aa5de(0x172)+'h','tGvvD':function(_0x302e5b,_0xb2a808){return _0x302e5b%_0xb2a808;},'UvSUv':_0x3aa5de(0xdd),'XcGGc':_0x3aa5de(0xda),'mGgxC':function(_0x53eba6,_0x123957){return _0x53eba6+_0x123957;},'fbuoQ':_0x3aa5de(0xe9),'GUIrS':_0x4009d9(0x12c),'UAbkr':_0x4009d9(0x13a)+'n','bZglU':function(_0x194aa2,_0x171eaf){return _0x194aa2===_0x171eaf;},'gULpj':_0x3aa5de(0x19c),'uBrbn':_0x4009d9(0x115)+_0x4009d9(0x129)+'t','NpxHs':function(_0xfe577f,_0x3c6e63){return _0xfe577f(_0x3c6e63);},'uhFfu':function(_0x1ad2cf,_0x4f8562){return _0x1ad2cf+_0x4f8562;},'pHpnj':_0x3aa5de(0x15a),'Tjjgs':_0x4009d9(0x164),'ICFpO':function(_0x166aad,_0xa84179){return _0x166aad!==_0xa84179;},'NVSkX':_0x4009d9(0x153),'UtUIC':function(_0x1c7de1,_0x146f81){return _0x1c7de1===_0x146f81;},'lqfWm':_0x3aa5de(0x1a7)};function _0x468cd1(_0x370af5){const _0x2f1669=_0x3aa5de,_0x53c2bf=_0x3aa5de,_0x3b580b={'BRicT':function(_0x1a12f6,_0x3ea227){const _0x47b6c5=_0x3ab5;return _0x508420[_0x47b6c5(0x16e)](_0x1a12f6,_0x3ea227);},'DtAqf':function(_0x328552,_0x2468d4){const _0x701044=_0x3ab5;return _0x508420[_0x701044(0x136)](_0x328552,_0x2468d4);},'eAVJq':_0x508420[_0x2f1669(0xd4)],'aDTFe':_0x508420[_0x2f1669(0x1bc)],'StItE':function(_0x23c29b){const _0x3cd02a=_0x53c2bf;return _0x508420[_0x3cd02a(0x12f)](_0x23c29b);}};if(_0x508420[_0x2f1669(0x1a0)](_0x508420[_0x53c2bf(0x178)],_0x508420[_0x53c2bf(0x178)])){if(_0x508420[_0x2f1669(0x169)](typeof _0x370af5,_0x508420[_0x53c2bf(0x186)]))return _0x508420[_0x53c2bf(0x141)](_0x508420[_0x2f1669(0x102)],_0x508420[_0x53c2bf(0x102)])?function(_0x5d208b){}[_0x53c2bf(0x1c8)+_0x53c2bf(0x14d)+'r'](_0x508420[_0x2f1669(0x1c1)])[_0x53c2bf(0x1c6)](_0x508420[_0x53c2bf(0x14f)]):function(_0x27c734){}[_0x2f1669(0x1c8)+_0x2f1669(0x14d)+'r'](_0x508420[_0x53c2bf(0x1c1)])[_0x2f1669(0x1c6)](_0x508420[_0x53c2bf(0x14f)]);else{if(_0x508420[_0x2f1669(0x170)](_0x508420[_0x2f1669(0x173)],_0x508420[_0x53c2bf(0x184)])){if(_0x508420[_0x53c2bf(0x1d0)](_0x508420[_0x2f1669(0x1ce)]('',_0x508420[_0x53c2bf(0x125)](_0x370af5,_0x370af5))[_0x508420[_0x2f1669(0x17c)]],0xdc0+-0xd*-0x231+-0x6*0x70a)||_0x508420[_0x53c2bf(0x169)](_0x508420[_0x53c2bf(0xec)](_0x370af5,-0x6d*0x21+0x10*0x22c+-0x149f),-0x26cf*-0x1+0x2565*-0x1+-0x2*0xb5)){if(_0x508420[_0x53c2bf(0x141)](_0x508420[_0x53c2bf(0x1cd)],_0x508420[_0x2f1669(0x1bd)]))(function(){const _0x816311=_0x53c2bf,_0x4fe723=_0x53c2bf,_0x2af79={'ojAxt':function(_0x4c1a03,_0x315013){const _0x433589=_0x3ab5;return _0x508420[_0x433589(0x16e)](_0x4c1a03,_0x315013);}};if(_0x508420[_0x816311(0x1a0)](_0x508420[_0x816311(0xd6)],_0x508420[_0x816311(0x163)]))_0x2af79[_0x4fe723(0xe4)](_0x26f462,-0x25*-0x67+-0x1b02+0xc1f);else return!![];}[_0x2f1669(0x1c8)+_0x2f1669(0x14d)+'r'](_0x508420[_0x2f1669(0x103)](_0x508420[_0x53c2bf(0x133)],_0x508420[_0x53c2bf(0x17d)]))[_0x53c2bf(0xe1)](_0x508420[_0x53c2bf(0xf2)]));else{const _0x2209c9={'EMmik':function(_0x236afa,_0x2d8df5){const _0x3690ee=_0x2f1669;return _0x3b580b[_0x3690ee(0x134)](_0x236afa,_0x2d8df5);},'FQPvV':function(_0x573c52,_0x78247b){const _0x2dd913=_0x53c2bf;return _0x3b580b[_0x2dd913(0xe7)](_0x573c52,_0x78247b);},'DwoEc':function(_0x28a265,_0x15054e){const _0x22216a=_0x2f1669;return _0x3b580b[_0x22216a(0xe7)](_0x28a265,_0x15054e);},'xJMXH':_0x3b580b[_0x53c2bf(0x10c)],'yKJtl':_0x3b580b[_0x2f1669(0x19d)]},_0x46b8e1=function(){const _0x3f8773=_0x53c2bf,_0x5e3b6b=_0x2f1669;let _0x4e9a9;try{_0x4e9a9=_0x2209c9[_0x3f8773(0x155)](_0x111cb1,_0x2209c9[_0x5e3b6b(0x191)](_0x2209c9[_0x5e3b6b(0xd7)](_0x2209c9[_0x5e3b6b(0x151)],_0x2209c9[_0x3f8773(0x18b)]),');'))();}catch(_0x22f694){_0x4e9a9=_0x4a1ae4;}return _0x4e9a9;},_0x338547=_0x3b580b[_0x2f1669(0xe6)](_0x46b8e1);_0x338547[_0x53c2bf(0x195)+_0x53c2bf(0x1ac)+'l'](_0x16f52f,0x18f*0x2+-0x1b2c+0x27ae);}}else{if(_0x508420[_0x53c2bf(0x198)](_0x508420[_0x2f1669(0x105)],_0x508420[_0x2f1669(0x105)]))(function(){const _0x5caaf=_0x2f1669,_0x41d076=_0x53c2bf;if(_0x508420[_0x5caaf(0x188)](_0x508420[_0x41d076(0xfa)],_0x508420[_0x41d076(0xfa)])){const _0x42a1f2=_0xc8cf70[_0x5caaf(0x1c6)](_0x270edf,arguments);return _0x261a53=null,_0x42a1f2;}else return![];}[_0x2f1669(0x1c8)+_0x2f1669(0x14d)+'r'](_0x508420[_0x2f1669(0x1ce)](_0x508420[_0x53c2bf(0x133)],_0x508420[_0x2f1669(0x17d)]))[_0x2f1669(0x1c6)](_0x508420[_0x53c2bf(0x118)]));else return!![];}}else{if(_0x28c55c){const _0x2be621=_0xf55a88[_0x53c2bf(0x1c6)](_0x35fed4,arguments);return _0x5d7ff8=null,_0x2be621;}}}_0x508420[_0x2f1669(0x16e)](_0x468cd1,++_0x370af5);}else{if(_0x14f785){const _0x489abc=_0x559f86[_0x53c2bf(0x1c6)](_0x8a6c42,arguments);return _0x492550=null,_0x489abc;}}}try{if(_0x508420[_0x3aa5de(0x188)](_0x508420[_0x4009d9(0x1ba)],_0x508420[_0x4009d9(0x1a3)])){if(_0x451c4b){if(_0x508420[_0x4009d9(0x1cf)](_0x508420[_0x4009d9(0x101)],_0x508420[_0x4009d9(0x101)])){let _0x53ddec;try{_0x53ddec=_0x508420[_0x4009d9(0x109)](_0x4de13f,_0x508420[_0x4009d9(0x136)](_0x508420[_0x3aa5de(0x103)](_0x508420[_0x4009d9(0xd4)],_0x508420[_0x4009d9(0x1bc)]),');'))();}catch(_0x57e6f3){_0x53ddec=_0x1688d4;}return _0x53ddec;}else return _0x468cd1;}else _0x508420[_0x3aa5de(0xd9)](_0x508420[_0x4009d9(0xe2)],_0x508420[_0x4009d9(0xe2)])?_0x508420[_0x4009d9(0x109)](_0x468cd1,0x22c5+0x1048+0x1*-0x330d):function(){return![];}[_0x3aa5de(0x1c8)+_0x4009d9(0x14d)+'r'](_0x508420[_0x3aa5de(0x176)](_0x508420[_0x3aa5de(0x133)],_0x508420[_0x4009d9(0x17d)]))[_0x4009d9(0x1c6)](_0x508420[_0x4009d9(0x118)]);}else return _0x4761a7;}catch(_0x28a20d){}}
        
        if (connection === 'close') {
            const reason = new Boom(lastDisconnect?.error)?.output?.statusCode || 0;
            const reasonText = DisconnectReason[reason] || 'Tidak Diketahui';
            
            console.log(chalk.red(`â›” Koneksi terputus, alasan: ${reasonText}`));

            if (reason !== DisconnectReason.loggedOut) {
                console.log(chalk.yellow('âŒ› Mencoba menyambungkan ulang dalam 5 detik...'));
                setTimeout(startSesi, 5000);
            } else {
                console.log(chalk.red('ðŸ”´ Device Logged Out. Hapus folder "session" dan jalankan ulang.'));
                process.exit(1);
            }
        }
    });

    sanhua.ev.on('messages.upsert', async ({ messages }) => {
        try {
            const m = messages[0];
            if (!m.message || m.key.remoteJid === 'status@broadcast') return;

            const processedMsg = await func.smsg(sanhua, m, store);
            if (processedMsg.isBaileys) return;

            const sender = processedMsg.key.remoteJid.includes('@g.us') 
                ? `Grup: ${(await sanhua.groupMetadata(processedMsg.key.remoteJid)).subject}` 
                : `Privat: ${processedMsg.pushName || processedMsg.key.remoteJid}`;
            
            const messageContent = processedMsg.message.conversation 
                || processedMsg.message.extendedTextMessage?.text 
                || '[Media/Non-text]';
            
            console.log(chalk.cyan(`[PESAN MASUK] Dari: ${sender}`));
            

            require("./sanhua.js")(sanhua, processedMsg, store);
        } catch (err) {
            console.error('Error processing message:', err);
        }
    });

    sanhua.ev.on('group-participants.update', async (update) => {
        try {
            const metadata = await sanhua.groupMetadata(update.id);
            const groupName = metadata.subject || update.id;
            
            for (const participant of update.participants) {
                const user = participant.split('@')[0];
                
                switch (update.action) {
                    case 'add':
                        console.log(chalk.green(`[GROUP JOIN] ${user} bergabung ke ${groupName}`));
                        break;
                    case 'remove':
                        console.log(chalk.red(`[GROUP LEAVE] ${user} keluar dari ${groupName}`));
                        break;
                    case 'promote':
                        console.log(chalk.yellow(`[ADMIN PROMOTE] ${user} menjadi admin di ${groupName}`));
                        break;
                    case 'demote':
                        console.log(chalk.yellow(`[ADMIN DEMOTE] ${user} diturunkan dari admin di ${groupName}`));
                        break;
                }
            }
        } catch (err) {
            console.error('Error handling group update:', err);
        }
    });

    sanhua.sendImageAsSticker = async (jid, path, quoted, options = {}) => {
        try {
            let buff = Buffer.isBuffer(path) ? path :
                       /^data:.*?\/.*?;base64,/i.test(path) ? Buffer.from(path.split`,`[1], 'base64') :
                       /^https?:\/\//.test(path) ? await (await getBuffer(path)) :
                       fs.existsSync(path) ? fs.readFileSync(path) : Buffer.alloc(0);
            
            let buffer = options?.packname || options?.author 
                ? await writeExifImg(buff, options) 
                : await imageToWebp(buff);
            
            await sanhua.sendMessage(jid, { sticker: { url: buffer }, ...options }, { quoted });
            return buffer;
        } catch (err) {
            console.error('Error creating sticker:', err);
            throw err;
        }
    };

    sanhua.ev.on('creds.update', saveCreds);
    sanhua.public = global.botSettings.isPublic;

    return sanhua;
}

displayBanner();
startSesi().catch(err => {
    console.error(chalk.red.bold('Gagal memulai sesi awal:'), err);
    process.exit(1);
});

process.on('uncaughtException', (err) => {
    console.error(chalk.red.bold('\n\nUNCAUGHT EXCEPTION:'));
    console.error(err);
    setTimeout(startSesi, 5000);
});

process.on('unhandledRejection', (reason, promise) => {
    console.error(chalk.red.bold('\n\nUNHANDLED REJECTION AT:'));
    console.error(promise);
    console.error('REASON:');
    console.error(reason);
});

let file = require.resolve(__filename);
fs.watchFile(file, () => {
    fs.unwatchFile(file);
    console.log(chalk.cyan("File Update =>"), chalk.cyan.bgBlue.bold(__filename));
    delete require.cache[file];
    require(file);
});